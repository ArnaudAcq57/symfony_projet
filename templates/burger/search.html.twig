{% extends 'base.html.twig' %}

{% block title %}Recherche avanc√©e de Burgers{% endblock %}

{% block body %}
<div class="container">
    <div class="top-navigation">
        <a href="{{ path('app_burger_list') }}" class="btn btn-back-top">‚Üê Retour</a>
    </div>
    
    <h1>üîç Recherche avanc√©e</h1>
    
    <div class="search-grid">
        {# --- Premi√®re ligne --- #}
        <div class="form-section">
            <h3>ü•¨ Par ingr√©dient</h3>
            <form action="{{ path('app_burger_search') }}" method="get">
                <input type="hidden" name="search_type" value="with_ingredient">
                <label for="ingredient">Ingr√©dient :</label>
                <input type="text" 
                       id="ingredient" 
                       name="ingredient" 
                       value="{{ searchParams.ingredientName|default('') }}"
                       list="ingredients-list"
                       autocomplete="off"
                       placeholder="Ex: Ketchup, Pain...">
                <datalist id="ingredients-list">
                    {% for ingredientName in all_ingredient_names %}
                        <option value="{{ ingredientName }}">{{ ingredientName }}</option>
                    {% endfor %}
                </datalist>
                <button type="submit" class="btn btn-primary">Rechercher</button>
            </form>
        </div>

        <div class="form-section">
            <h3>üí∞ Plus chers</h3>
            <form action="{{ path('app_burger_search') }}" method="get">
                <input type="hidden" name="search_type" value="top_expensive">
                <label for="limit">Nombre :</label>
                <input type="number" id="limit" name="limit" value="{{ searchParams.limit|default(5) }}" min="1">
                <button type="submit" class="btn btn-primary">Rechercher</button>
            </form>
        </div>

        {# --- Deuxi√®me ligne --- #}
        <div class="form-section">
            <h3>üö´ Sans sauce</h3>
            <form action="{{ path('app_burger_search') }}" method="get">
                <input type="hidden" name="search_type" value="without_ingredient">
                <label for="sauce_id">Exclure :</label>
                <select id="sauce_id" name="sauce_id">
                    <option value="">-- Choisir --</option>
                    {% for sauce in all_sauces %}
                        <option value="{{ sauce.id }}" {{ searchParams.sauce is defined and searchParams.sauce.id == sauce.id ? 'selected' : '' }}>
                            {{ sauce.name }}
                        </option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary">Rechercher</button>
            </form>
        </div>

        <div class="form-section">
            <h3>üî¢ Min. ingr√©dients</h3>
            <form action="{{ path('app_burger_search') }}" method="get">
                <input type="hidden" name="search_type" value="min_ingredients">
                <label for="min">Minimum :</label>
                <input type="number" id="min" name="min" value="{{ searchParams.min|default(2) }}" min="0">
                <small>Sauces + oignons</small>
                <button type="submit" class="btn btn-primary">Rechercher</button>
            </form>
        </div>
    </div>

    {# --- R√©sultats --- #}
    {% if searchType %}
        <div class="results-section">
            <h2>üìã R√©sultats</h2>
            {% if results is not empty %}
                <div class="results-count">
                    {{ results|length }} burger(s) trouv√©(s)
                </div>
                <ul class="burger-list">
                    {% for burger in results %}
                        <li>
                            <a href="{{ path('app_burger_show', {id: burger.id}) }}">{{ burger.name }}</a>
                            <span class="price">{{ burger.price }}‚Ç¨</span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="alert alert-info">
                    <strong>Aucun r√©sultat</strong> pour cette recherche.
                </div>
            {% endif %}
        </div>
    {% endif %}
</div>

<style>
    /* Navigation en haut √† gauche */
    .top-navigation {
        position: absolute;
        top: 1rem;
        left: 1rem;
        z-index: 10;
    }
    
    .btn-back-top {
        background: var(--text-muted);
        color: white;
        padding: 0.6rem 1rem;
        border-radius: var(--border-radius);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        transition: var(--transition);
        display: inline-block;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .btn-back-top:hover {
        background: #6c7b7d;
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .results-count {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin-bottom: 1rem;
        font-style: italic;
    }
    
    small {
        display: block;
        color: var(--text-muted);
        font-size: 0.85rem;
        margin-top: -0.5rem;
        margin-bottom: 1rem;
    }
    
    /* Container avec plus d'espace en haut pour le bouton */
    .container {
        padding: 3rem 1.5rem 1.5rem 1.5rem;
        margin: 1.5rem auto;
        position: relative;
    }
    
    /* Responsive pour petits √©crans */
    @media (max-width: 768px) {
        .top-navigation {
            position: static;
            margin-bottom: 1rem;
        }
        
        .container {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}